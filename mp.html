<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Aplikasi Pembayaran (Cash / TF / Kredit) — Versi Revisi</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <style>
    body{padding:20px}
    .card{margin-bottom:16px}
  </style>
</head>
<body>
<div class="container">
  <h2 class="mb-3">Aplikasi Pembayaran — Cash / Transfer / Kredit (Revisi)</h2>

  <!-- PILIH PRODUK & METODE PEMBAYARAN -->
  <div class="card">
    <div class="card-body">
      <h5>Pilih Produk</h5>
      <select id="productSelect" class="form-select mb-3"></select>

      <h5>Pilih Metode Pembayaran</h5>
      <select id="paymentMethod" class="form-select mb-3">
        <option value="">-- pilih metode --</option>
        <option value="cash">Cash</option>
        <option value="transfer">Transfer (TF)</option>
        <option value="kredit">Kredit</option>
      </select>

      <!-- CASH -->
      <div id="cashBox" style="display:none">
        <h5>Pembayaran Cash</h5>
        <div class="mb-2">
          <label>Total Harga</label>
          <input id="cashTotal" class="form-control" readonly>
        </div>
        <div class="mb-2">
          <label>Jumlah Pembayaran</label>
          <input id="cashPaid" type="number" class="form-control">
        </div>
        <div class="mb-2">
          <label>Kembalian</label>
          <input id="cashChange" class="form-control" readonly>
        </div>
        <button class="btn btn-success" id="btnCashPay">Selesaikan Pembayaran</button>
      </div>

      <!-- TRANSFER -->
      <div id="tfBox" style="display:none">
        <h5>Pembayaran Transfer (TF)</h5>
        <div class="mb-2">
          <label>Total yang harus dibayar</label>
          <input id="tfTotal" class="form-control" readonly>
        </div>
        <div class="mb-2">
          <label>Jumlah Transfer</label>
          <input id="tfPaid" type="number" class="form-control">
        </div>
        <div class="mb-2">
          <label>Upload Bukti Pembayaran</label>
          <input id="tfProof" type="file" class="form-control">
        </div>
        <button class="btn btn-primary mb-2" id="btnTfPay">Konfirmasi Pembayaran</button>

        <div id="offerKreditBox" class="alert alert-warning" style="display:none">
          Jumlah transfer <b>tidak sesuai</b> dengan total pembayaran.<br>
          Ingin melanjutkan sebagai <b>Kredit</b>?
          <br><button class="btn btn-warning mt-2" id="btnConvertKredit">Lanjutkan Kredit</button>
        </div>
      </div>

      <!-- KREDIT -->
      <div id="kreditBox" style="display:none">
        <h5>Pembayaran Kredit</h5>
        <div class="mb-2">
          <label>DP</label>
          <input id="kreditDp" type="number" class="form-control" value="0">
        </div>
        <div class="mb-2">
          <label>Tenor (bulan)</label>
          <input id="kreditTenor" type="number" class="form-control" value="12">
        </div>
        <button class="btn btn-success" id="btnCreateKredit">Buat Cicilan</button>
      </div>
    </div>
  </div>
</div>

<script>
// DATA PRODUK
let produk = [
  {id:1, nama:"Kulkas 2 Pintu", harga:4500000},
  {id:2, nama:"TV LED 32\"", harga:2200000},
  {id:3, nama:"Laptop", harga:6500000}
];

const productSelect = document.getElementById('productSelect');
const payMethod = document.getElementById('paymentMethod');

function loadProducts(){
  productSelect.innerHTML="";
  produk.forEach(p=>{
    const o = document.createElement('option');
    o.value = p.id;
    o.textContent = `${p.nama} — Rp ${p.harga.toLocaleString('id-ID')}`;
    productSelect.appendChild(o);
  });
}
loadProducts();

// SWITCH BOX
payMethod.addEventListener('change',()=>{
  document.getElementById('cashBox').style.display = 'none';
  document.getElementById('tfBox').style.display = 'none';
  document.getElementById('kreditBox').style.display = 'none';

  let p = produk.find(x=>x.id==productSelect.value);
  if(!p) return;

  if(payMethod.value==='cash'){
    document.getElementById('cashBox').style.display='block';
    document.getElementById('cashTotal').value = p.harga;
  }

  if(payMethod.value==='transfer'){
    document.getElementById('tfBox').style.display='block';
    document.getElementById('tfTotal').value = p.harga;
  }

  if(payMethod.value==='kredit'){
    document.getElementById('kreditBox').style.display='block';
  }
});

/* =============================
   PEMBAYARAN CASH
============================= */
const cashPaid = document.getElementById('cashPaid');
cashPaid.addEventListener('input',()=>{
  let total = Number(document.getElementById('cashTotal').value);
  let bayar = Number(cashPaid.value);
  let kembali = bayar - total;
  document.getElementById('cashChange').value = kembali >= 0 ? kembali : 0;
});

document.getElementById('btnCashPay').addEventListener('click',()=>{
  let total = Number(document.getElementById('cashTotal').value);
  let bayar = Number(cashPaid.value);

  if(bayar < total)
    return Swal.fire('Pembayaran Kurang','Jumlah pembayaran belum mencukupi','error');

  Swal.fire('Berhasil','Status Pembayaran: <b>LUNAS</b>','success');
});

/* =============================
   PEMBAYARAN TRANSFER (TF)
============================= */
document.getElementById('btnTfPay').addEventListener('click',()=>{
  const total = Number(document.getElementById('tfTotal').value);
  const bayar = Number(document.getElementById('tfPaid').value);
  const bukti = document.getElementById('tfProof').files.length;

  if(bayar === total){
    if(!bukti)
      return Swal.fire('Bukti diperlukan','Upload bukti pembayaran','warning');

    Swal.fire('Pembayaran Berhasil','Status: <b>LUNAS</b>','success');
  } else {
    document.getElementById('offerKreditBox').style.display='block';
  }
});

document.getElementById('btnConvertKredit').addEventListener('click',()=>{
  payMethod.value = 'kredit';
  payMethod.dispatchEvent(new Event('change'));
  document.getElementById('offerKreditBox').style.display='none';
});

/* =============================
   PEMBAYARAN KREDIT
============================= */
document.getElementById('btnCreateKredit').addEventListener('click',()=>{
  let dp = Number(document.getElementById('kreditDp').value);
  let tenor = Number(document.getElementById('kreditTenor').value);
  let p = produk.find(x=>x.id==productSelect.value);

  if(dp > p.harga)
    return Swal.fire('DP Terlalu Besar','DP tidak boleh melebihi harga produk','error');

  Swal.fire('Cicilan Dibuat',`Cicilan dibuat dengan tenor ${tenor} bulan`, 'success');
});
</script>
</body>
</html>
