<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Dashboard Multi Role — Superadmin / Admin / Operator / User</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <style>
    :root{--bg:#f5f7fb;--card:#fff;--sidebar:#1e1e2d;--text:#212529}
    [data-theme='dark']{--bg:#0f1724;--card:#0b1220;--sidebar:#0b1226;--text:#e6eef8}
    body{background:var(--bg);color:var(--text);}
    .sidebar{min-height:100vh;background:var(--sidebar);color:white}
    .sidebar a{color:#d1d1d1;text-decoration:none;padding:10px 16px;display:block}
    .sidebar a:hover{background:#2b2b3f;color:#fff}
    .role-badge{font-size:.85rem}
    .card{background:var(--card)}
    .small-muted{font-size:.85rem;color:rgba(0,0,0,.5)}
  </style>
</head>
<body>

<nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm">
  <div class="container-fluid">
    <a class="navbar-brand" href="#"><i class="fa-solid fa-shop"></i> MultiRole POS</a>

    <div class="d-flex align-items-center gap-2">
      <div id="currentUserArea" class="me-2"></div>
      <div class="form-check form-switch me-2">
        <input class="form-check-input" type="checkbox" id="themeToggle">
        <label class="form-check-label" for="themeToggle">Dark</label>
      </div>
      <button class="btn btn-outline-primary" id="btnLogin">Login</button>
      <div class="dropdown d-none" id="roleSwitchDropdown">
        <button class="btn btn-sm btn-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown">Switch Role</button>
        <ul class="dropdown-menu" id="roleSwitchList"></ul>
      </div>
    </div>
  </div>
</nav>

<div class="d-flex">
  <div class="sidebar p-3" style="width:260px">
    <h5 class="text-center">Dashboard</h5>
    <div class="text-center mb-3"><span id="roleBadge" class="badge bg-primary role-badge">guest</span></div>
    <div id="menuList"></div>
    <hr class="border-light">
    <div class="text-center small-muted">Tips: Login untuk melihat menu sesuai role</div>
  </div>

  <main class="flex-grow-1 p-4">
    <div class="d-flex justify-content-between align-items-center mb-3">
      <h3 id="pageTitle">Selamat datang</h3>
      <div>
        <button class="btn btn-sm btn-success" id="exportBtn"><i class="fa-solid fa-file-export"></i> Export Data</button>
        <button class="btn btn-sm btn-secondary" id="importBtn"><i class="fa-solid fa-file-import"></i> Import Data</button>
      </div>
    </div>

    <div id="contentArea">
      <div class="card p-3">
        <h5>Overview Sistem</h5>
        <div class="row">
          <div class="col-md-3 mb-3"><div class="p-3 border rounded">Users<br><strong id="statUsers">0</strong></div></div>
          <div class="col-md-3 mb-3"><div class="p-3 border rounded">Produk<br><strong id="statProducts">0</strong></div></div>
          <div class="col-md-3 mb-3"><div class="p-3 border rounded">Transaksi<br><strong id="statTx">0</strong></div></div>
          <div class="col-md-3 mb-3"><div class="p-3 border rounded">Pendapatan<br><strong id="statRevenue">Rp0</strong></div></div>
        </div>
      </div>
    </div>
  </main>
</div>

<!-- Modals: Login, CRUD generic -->
<div class="modal fade" id="loginModal" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header"><h5 class="modal-title">Login / Simulasi</h5><button class="btn-close" data-bs-dismiss="modal"></button></div>
      <div class="modal-body">
        <form id="loginForm">
          <div class="mb-3">
            <label class="form-label">Pilih Role</label>
            <select class="form-select" id="loginRole">
              <option value="guest">Guest</option>
              <option value="superadmin">Superadmin</option>
              <option value="admin">Admin</option>
              <option value="operator">Operator</option>
              <option value="user">User</option>
            </select>
          </div>
          <div class="mb-3">
            <label class="form-label">Nama</label>
            <input class="form-control" id="loginName" placeholder="Nama pengguna" />
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" data-bs-dismiss="modal">Batal</button>
        <button class="btn btn-primary" id="doLoginBtn">Login</button>
      </div>
    </div>
  </div>
</div>

<!-- CRUD modals placeholder -->
<div id="crudModals"></div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
// -------------------- Data layer (localStorage) --------------------
const STORAGE_KEY = 'multi_role_system_v1';
const DEFAULT_DATA = {
  users: [
    {id:1,name:'Super Admin',role:'superadmin',phone:'081234567890'},
    {id:2,name:'Admin Toko',role:'admin',phone:'081122334455'},
    {id:3,name:'Operator Kasir',role:'operator',phone:'082233445566'},
    {id:4,name:'Budi Pelanggan',role:'user',phone:'08566778899'}
  ],
  suppliers: [],
  categories: [],
  products: [
    {id:1,name:'Produk A',price:100000,stock:10,category:'Umum'},
    {id:2,name:'Produk B',price:75000,stock:5,category:'Umum'}
  ],
  transactions: []
};

function loadData(){
  const raw = localStorage.getItem(STORAGE_KEY);
  if(!raw){
    localStorage.setItem(STORAGE_KEY,JSON.stringify(DEFAULT_DATA));
    return JSON.parse(JSON.stringify(DEFAULT_DATA));
  }
  return JSON.parse(raw);
}
function saveData(data){ localStorage.setItem(STORAGE_KEY,JSON.stringify(data)); }

let DB = loadData();

// -------------------- Auth & role --------------------
let currentUser = JSON.parse(localStorage.getItem('mrs_current_user')||'null');
function setCurrentUser(user){ currentUser = user; localStorage.setItem('mrs_current_user', JSON.stringify(user)); renderHeader(); renderMenu(); }
function logout(){ localStorage.removeItem('mrs_current_user'); currentUser=null; renderHeader(); renderMenu(); showHome(); }

function renderHeader(){
  const area = document.getElementById('currentUserArea');
  const roleBadge = document.getElementById('roleBadge');
  if(currentUser){
    area.innerHTML = `<small class='d-block'>${currentUser.name}</small><small class='small-muted'>${currentUser.role}</small>`;
    roleBadge.innerText = currentUser.role;
    document.getElementById('btnLogin').innerText = 'Logout';
    document.getElementById('btnLogin').classList.remove('btn-outline-primary');
    document.getElementById('btnLogin').classList.add('btn-danger');
    document.getElementById('roleSwitchDropdown').classList.remove('d-none');
  } else {
    area.innerHTML = `<small class='small-muted'>Belum login</small>`;
    roleBadge.innerText = 'guest';
    document.getElementById('btnLogin').innerText = 'Login';
    document.getElementById('btnLogin').classList.remove('btn-danger');
    document.getElementById('btnLogin').classList.add('btn-outline-primary');
    document.getElementById('roleSwitchDropdown').classList.add('d-none');
  }
}

// -------------------- Menu per role --------------------
const MENUS = {
  superadmin: [
    {id:'users',title:'Manajemen Users',icon:'fa-users'},
    {id:'suppliers',title:'Manajemen Supplier',icon:'fa-truck'},
    {id:'categories',title:'Manajemen Kategori',icon:'fa-tags'},
    {id:'products',title:'Manajemen Produk',icon:'fa-box-open'},
    {id:'transactions',title:'Transaksi',icon:'fa-cart-shopping'},
    {id:'payments',title:'Pembayaran',icon:'fa-money-bill-transfer'},
    {id:'reports',title:'Laporan',icon:'fa-chart-line'},
    {id:'settings',title:'Settings',icon:'fa-gear'}
  ],
  admin: [
    {id:'products',title:'Manajemen Produk',icon:'fa-box-open'},
    {id:'transactions',title:'Transaksi',icon:'fa-cart-shopping'},
    {id:'payments',title:'Pembayaran',icon:'fa-money-bill-transfer'},
    {id:'reports',title:'Laporan',icon:'fa-file-lines'}
  ],
  operator: [
    {id:'transactions',title:'Input Transaksi',icon:'fa-cash-register'},
    {id:'payments',title:'Pembayaran',icon:'fa-credit-card'},
    {id:'orders',title:'Status Order',icon:'fa-list'}
  ],
  user: [
    {id:'profile',title:'Profil Saya',icon:'fa-user'},
    {id:'history',title:'Riwayat Pembelian',icon:'fa-clock-rotate-left'},
    {id:'cart',title:'Keranjang',icon:'fa-cart-plus'}
  ],
  guest: [
    {id:'home',title:'Home',icon:'fa-house'}
  ]
};

function renderMenu(){
  const area = document.getElementById('menuList');
  const role = currentUser?currentUser.role:'guest';
  const items = MENUS[role]||[];
  area.innerHTML = items.map(i=>`<a href='#' data-id='${i.id}' class='menu-item'><i class='fa ${i.icon}'></i> ${i.title}</a>`).join('');
  // attach listeners
  document.querySelectorAll('.menu-item').forEach(el=>el.addEventListener('click', (e)=>{
    e.preventDefault(); const id = el.getAttribute('data-id'); openPage(id);
  }));
}

// role switcher list
function renderRoleSwitchList(){
  const list = document.getElementById('roleSwitchList');
  const roles = ['superadmin','admin','operator','user'];
  list.innerHTML = roles.map(r=>`<li><a class='dropdown-item' href='#' data-role='${r}'>${r}</a></li>`).join('');
  list.querySelectorAll('a').forEach(a=>a.addEventListener('click', (ev)=>{ ev.preventDefault(); const r= a.getAttribute('data-role'); if(currentUser){ currentUser.role=r; setCurrentUser(currentUser); Swal.fire({icon:'success',title:'Role diubah',text:`Role sekarang ${r}`}); } }));
}

// -------------------- Pages & CRUD render --------------------
function showHome(){
  document.getElementById('pageTitle').innerText='Dashboard';
  document.getElementById('contentArea').innerHTML = `
    <div class='card p-3'>
      <h5>Overview Sistem</h5>
      <div class='row'>
        <div class='col-md-3 mb-3'><div class='p-3 border rounded'>Users<br><strong id='statUsers'>${DB.users.length}</strong></div></div>
        <div class='col-md-3 mb-3'><div class='p-3 border rounded'>Produk<br><strong id='statProducts'>${DB.products.length}</strong></div></div>
        <div class='col-md-3 mb-3'><div class='p-3 border rounded'>Transaksi<br><strong id='statTx'>${DB.transactions.length}</strong></div></div>
        <div class='col-md-3 mb-3'><div class='p-3 border rounded'>Pendapatan<br><strong id='statRevenue'>Rp${calcRevenue()}</strong></div></div>
      </div>
    </div>
  `;
}

function calcRevenue(){
  let sum = DB.transactions.reduce((s,t)=> s + (t.total||0),0);
  return new Intl.NumberFormat('id-ID').format(sum);
}

function openPage(id){
  document.getElementById('pageTitle').innerText = MENUS[currentUser?currentUser.role:'guest']?.find(x=>x.id==id)?.title || id;
  if(id==='users') renderUsersPage();
  else if(id==='products') renderProductsPage();
  else if(id==='suppliers') renderSuppliersPage();
  else if(id==='categories') renderCategoriesPage();
  else if(id==='transactions') renderTransactionsPage();
  else if(id==='reports') renderReportsPage();
  else showHome();
}

// -- Users CRUD --
function renderUsersPage(){
  document.getElementById('contentArea').innerHTML = `
    <div class='card p-3'>
      <div class='d-flex justify-content-between mb-2'><h5>Manajemen Users</h5><div><button class='btn btn-sm btn-primary' id='addUserBtn'>Tambah User</button></div></div>
      <div id='usersTable'></div>
    </div>
  `;
  document.getElementById('addUserBtn').addEventListener('click', ()=> openUserForm());
  refreshUsersTable();
}
function refreshUsersTable(){
  const html = `
    <table class='table table-striped'>
      <thead><tr><th>#</th><th>Nama</th><th>Role</th><th>Phone</th><th>Aksi</th></tr></thead>
      <tbody>${DB.users.map(u=>`<tr><td>${u.id}</td><td>${u.name}</td><td>${u.role}</td><td>${u.phone||'-'}</td><td>
        <button class='btn btn-sm btn-warning' data-id='${u.id}' data-act='edit'>Edit</button>
        <button class='btn btn-sm btn-danger' data-id='${u.id}' data-act='delete'>Hapus</button>
      </td></tr>`).join('')}</tbody>
    </table>
  `;
  document.getElementById('usersTable').innerHTML = html;
  document.querySelectorAll('[data-act]').forEach(btn=>btn.addEventListener('click', (e)=>{
    const id = Number(btn.getAttribute('data-id'));
    const act = btn.getAttribute('data-act');
    if(act==='edit') openUserForm(DB.users.find(x=>x.id===id));
    if(act==='delete') deleteUser(id);
  }));
}
function openUserForm(user=null){
  const isEdit = !!user;
  Swal.fire({
    title: isEdit? 'Edit User':'Tambah User',
    html: `
      <input id='swalName' class='swal2-input' placeholder='Nama' value='${user?user.name:''}' />
      <select id='swalRole' class='swal2-input'>
        <option value='superadmin'>superadmin</option>
        <option value='admin'>admin</option>
        <option value='operator'>operator</option>
        <option value='user'>user</option>
      </select>
      <input id='swalPhone' class='swal2-input' placeholder='Phone' value='${user?user.phone:''}' />
    `,
    focusConfirm:false,
    preConfirm: ()=>{
      return {
        name:document.getElementById('swalName').value,
        role:document.getElementById('swalRole').value,
        phone:document.getElementById('swalPhone').value
      }
    }
  }).then(res=>{
    if(res.isConfirmed){
      const v = res.value;
      if(isEdit){
        const idx = DB.users.findIndex(x=>x.id===user.id);
        DB.users[idx] = {...DB.users[idx], ...v};
      }else{
        const nid = (DB.users.reduce((a,b)=>Math.max(a,b.id),0)||0)+1;
        DB.users.push({id:nid,...v});
      }
      saveData(DB); refreshUsersTable(); renderHeader(); Swal.fire('Sukses','Data tersimpan','success');
    }
  });
}
function deleteUser(id){
  Swal.fire({title:'Hapus user?',text:'Data akan dihapus permanent',icon:'warning',showCancelButton:true}).then(r=>{
    if(r.isConfirmed){ DB.users = DB.users.filter(u=>u.id!==id); saveData(DB); refreshUsersTable(); Swal.fire('Terhapus','User dihapus','success'); }
  })
}

// -- Products CRUD (sederhana) --
function renderProductsPage(){
  document.getElementById('contentArea').innerHTML = `
    <div class='card p-3'>
      <div class='d-flex justify-content-between mb-2'><h5>Manajemen Produk</h5><div><button class='btn btn-sm btn-primary' id='addProductBtn'>Tambah Produk</button></div></div>
      <div id='productsTable'></div>
    </div>
  `;
  document.getElementById('addProductBtn').addEventListener('click', ()=> openProductForm());
  refreshProductsTable();
}
function refreshProductsTable(){
  const html = `
    <table class='table table-hover'>
      <thead><tr><th>#</th><th>Nama</th><th>Harga</th><th>Stok</th><th>Kategori</th><th>Aksi</th></tr></thead>
      <tbody>${DB.products.map(p=>`<tr><td>${p.id}</td><td>${p.name}</td><td>Rp${new Intl.NumberFormat('id-ID').format(p.price)}</td><td>${p.stock}</td><td>${p.category||'-'}</td><td>
        <button class='btn btn-sm btn-warning' data-id='${p.id}' data-act='edit'>Edit</button>
        <button class='btn btn-sm btn-danger' data-id='${p.id}' data-act='delete'>Hapus</button>
      </td></tr>`).join('')}</tbody>
    </table>
  `;
  document.getElementById('productsTable').innerHTML = html;
  document.querySelectorAll('[data-act]').forEach(btn=>btn.addEventListener('click', (e)=>{
    const id = Number(btn.getAttribute('data-id'));
    const act = btn.getAttribute('data-act');
    if(act==='edit') openProductForm(DB.products.find(x=>x.id===id));
    if(act==='delete') deleteProduct(id);
  }));
}
function openProductForm(prod=null){
  const isEdit = !!prod;
  Swal.fire({
    title: isEdit? 'Edit Produk':'Tambah Produk',
    html: `
      <input id='pname' class='swal2-input' placeholder='Nama' value='${prod?prod.name:''}' />
      <input id='pprice' class='swal2-input' placeholder='Harga' value='${prod?prod.price:''}' />
      <input id='pstock' class='swal2-input' placeholder='Stok' value='${prod?prod.stock:''}' />
      <input id='pcat' class='swal2-input' placeholder='Kategori' value='${prod?prod.category:''}' />
    `,
    preConfirm: ()=>({name:document.getElementById('pname').value,price:Number(document.getElementById('pprice').value||0),stock:Number(document.getElementById('pstock').value||0),category:document.getElementById('pcat').value})
  }).then(res=>{
    if(res.isConfirmed){
      const v=res.value;
      if(isEdit){
        const idx = DB.products.findIndex(x=>x.id===prod.id);
        DB.products[idx] = {...DB.products[idx],...v};
      }else{
        const nid=(DB.products.reduce((a,b)=>Math.max(a,b.id),0)||0)+1; DB.products.push({id:nid,...v});
      }
      saveData(DB); refreshProductsTable(); Swal.fire('Sukses','Produk tersimpan','success');
    }
  })
}
function deleteProduct(id){
  Swal.fire({title:'Hapus produk?',icon:'warning',showCancelButton:true}).then(r=>{ if(r.isConfirmed){ DB.products = DB.products.filter(p=>p.id!==id); saveData(DB); refreshProductsTable(); Swal.fire('Terhapus','Produk dihapus','success'); } })
}

// -- Suppliers & Categories simple pages (similar pattern) --
function renderSuppliersPage(){
  document.getElementById('contentArea').innerHTML = `<div class='card p-3'><h5>Manajemen Supplier (sederhana)</h5><div id='suppliersTable'></div></div>`; refreshSuppliersTable();
}
function refreshSuppliersTable(){
  const html = `<table class='table'><thead><tr><th>#</th><th>Nama</th><th>Aksi</th></tr></thead><tbody>${DB.suppliers.map((s,i)=>`<tr><td>${i+1}</td><td>${s.name}</td><td><button class='btn btn-sm btn-danger' data-i='${i}'>Hapus</button></td></tr>`).join('')}</tbody></table><button class='btn btn-sm btn-primary' id='addSupplier'>Tambah</button>`;
  document.getElementById('suppliersTable').innerHTML = html;
  document.getElementById('addSupplier').addEventListener('click', ()=>{
    Swal.fire({title:'Tambah Supplier',input:'text',inputLabel:'Nama supplier'}).then(r=>{ if(r.value){ DB.suppliers.push({name:r.value}); saveData(DB); refreshSuppliersTable(); Swal.fire('Sukses','Supplier ditambahkan','success'); } })
  });
  document.querySelectorAll('[data-i]').forEach(b=>b.addEventListener('click', ()=>{ const i=Number(b.getAttribute('data-i')); DB.suppliers.splice(i,1); saveData(DB); refreshSuppliersTable(); Swal.fire('Terhapus','Supplier dihapus','success'); }));
}

function renderCategoriesPage(){
  document.getElementById('contentArea').innerHTML = `<div class='card p-3'><h5>Manajemen Kategori</h5><div id='catTable'></div></div>`; refreshCategoriesTable();
}
function refreshCategoriesTable(){
  const html = `<table class='table'><thead><tr><th>#</th><th>Nama</th><th>Aksi</th></tr></thead><tbody>${DB.categories.map((c,i)=>`<tr><td>${i+1}</td><td>${c}</td><td><button class='btn btn-sm btn-danger' data-i='${i}'>Hapus</button></td></tr>`).join('')}</tbody></table><button class='btn btn-sm btn-primary' id='addCat'>Tambah</button>`;
  document.getElementById('catTable').innerHTML = html;
  document.getElementById('addCat').addEventListener('click', ()=>{
    Swal.fire({title:'Tambah Kategori',input:'text',inputLabel:'Nama kategori'}).then(r=>{ if(r.value){ DB.categories.push(r.value); saveData(DB); refreshCategoriesTable(); Swal.fire('Sukses','Kategori ditambahkan','success'); } })
  });
  document.querySelectorAll('[data-i]').forEach(b=>b.addEventListener('click', ()=>{ const i=Number(b.getAttribute('data-i')); DB.categories.splice(i,1); saveData(DB); refreshCategoriesTable(); Swal.fire('Terhapus','Kategori dihapus','success'); }));
}

// -- Transactions (very simplified POS) --
function renderTransactionsPage(){
  document.getElementById('contentArea').innerHTML = `
    <div class='card p-3'>
      <div class='d-flex justify-content-between mb-2'><h5>Transaksi POS</h5><div><button class='btn btn-sm btn-primary' id='newTx'>Buat Transaksi</button></div></div>
      <div id='txTable'></div>
    </div>
  `;
  document.getElementById('newTx').addEventListener('click', ()=> openCreateTransaction());
  refreshTxTable();
}
function refreshTxTable(){
  const html = `<table class='table'><thead><tr><th>#</th><th>Tanggal</th><th>Total</th><th>Status</th></tr></thead><tbody>${DB.transactions.map((t,i)=>`<tr><td>${i+1}</td><td>${new Date(t.date).toLocaleString()}</td><td>Rp${new Intl.NumberFormat('id-ID').format(t.total)}</td><td>${t.status}</td></tr>`).join('')}</tbody></table>`;
  document.getElementById('txTable').innerHTML = html;
}
function openCreateTransaction(){
  // very simple: choose product & qty, calculate total, simulate payment methods
  const prodOptions = DB.products.map(p=>`<option value='${p.id}'>${p.name} — Rp${new Intl.NumberFormat('id-ID').format(p.price)}</option>`).join('');
  Swal.fire({
    title:'Buat Transaksi',
    html:`
      <select id='selProd' class='swal2-input'>${prodOptions}</select>
      <input id='qty' class='swal2-input' placeholder='Jumlah' value='1' />
      <select id='payMethod' class='swal2-input'><option value='cash'>Cash</option><option value='tf'>Transfer</option><option value='kredit'>Kredit</option></select>
    `,
    preConfirm: ()=>({prodId:Number(document.getElementById('selProd').value),qty:Number(document.getElementById('qty').value),method:document.getElementById('payMethod').value})
  }).then(res=>{
    if(res.isConfirmed){
      const p=DB.products.find(x=>x.id===res.value.prodId);
      const total = p.price * res.value.qty;
      const tx = {id: (DB.transactions.length?DB.transactions[DB.transactions.length-1].id+1:1),date:Date.now(),items:[{product:p.id,q:res.value.qty,price:p.price}],total:total,status: (res.value.method==='kredit'?'kredit':'paid')};
      DB.transactions.push(tx); saveData(DB); refreshTxTable(); showHome(); Swal.fire('Transaksi dibuat',`Total: Rp${new Intl.NumberFormat('id-ID').format(total)}`,'success');
    }
  })
}

// -- Reports (simple) --
function renderReportsPage(){
  document.getElementById('contentArea').innerHTML = `<div class='card p-3'><h5>Laporan</h5><p class='small-muted'>Ringkasan transaksi</p><div id='reportArea'></div></div>`; renderReportSummary();
}
function renderReportSummary(){
  const totalTx = DB.transactions.length;
  const revenue = calcRevenue();
  document.getElementById('reportArea').innerHTML = `<ul><li>Total Transaksi: ${totalTx}</li><li>Pendapatan: Rp${revenue}</li></ul>`;
}

// -------------------- Utilities, Login UI --------------------
document.getElementById('btnLogin').addEventListener('click', ()=>{
  if(currentUser){ Swal.fire({title:'Keluar?',showCancelButton:true}).then(r=>{ if(r.isConfirmed) logout(); }); return; }
  const modal = new bootstrap.Modal(document.getElementById('loginModal')); modal.show();
});

document.getElementById('doLoginBtn').addEventListener('click', ()=>{
  const role = document.getElementById('loginRole').value; const name = document.getElementById('loginName').value||('User-'+Math.floor(Math.random()*1000));
  const u = {id:Date.now(),name,role}; setCurrentUser(u); bootstrap.Modal.getInstance(document.getElementById('loginModal')).hide(); Swal.fire('Login berhasil',`Halo ${name} sebagai ${role}`,'success');
});

// Export / Import
document.getElementById('exportBtn').addEventListener('click', ()=>{
  const dataStr = JSON.stringify(DB, null, 2);
  const blob = new Blob([dataStr],{type:'application/json'}); const url = URL.createObjectURL(blob);
  const a = document.createElement('a'); a.href=url; a.download='mrs-data-export.json'; a.click(); URL.revokeObjectURL(url);
});

document.getElementById('importBtn').addEventListener('click', ()=>{
  const input = document.createElement('input'); input.type='file'; input.accept='application/json'; input.onchange = (e)=>{
    const f = e.target.files[0]; if(!f) return; const r = new FileReader(); r.onload = ()=>{ try{ DB = JSON.parse(r.result); saveData(DB); Swal.fire('Import sukses','Data diimport','success'); renderMenu(); showHome(); }catch(err){ Swal.fire('Error','Format file tidak valid','error'); } }; r.readAsText(f);
  }; input.click();
});

// Theme toggle
const themeToggle = document.getElementById('themeToggle');
if(localStorage.getItem('mrs_theme')==='dark'){ document.documentElement.setAttribute('data-theme','dark'); themeToggle.checked=true; }
themeToggle.addEventListener('change', ()=>{ if(themeToggle.checked){ document.documentElement.setAttribute('data-theme','dark'); localStorage.setItem('mrs_theme','dark'); } else { document.documentElement.removeAttribute('data-theme'); localStorage.removeItem('mrs_theme'); } });

// Init
renderRoleSwitchList(); renderHeader(); renderMenu(); showHome();

</script>
</body>

<!-- BACKEND: Laravel (API) + MySQL — Quick scaffolding & migration
1) Buat project Laravel: composer create-project laravel/laravel mrs-backend
2) .env: isi DB_CONNECTION=mysql, DB_HOST, DB_PORT, DB_DATABASE, DB_USERNAME, DB_PASSWORD
3) Migration (contoh tabel users, products, categories, suppliers, transactions, transaction_items):
   php artisan make:migration create_users_table --create=users
   php artisan make:migration create_products_table --create=products
   php artisan make:migration create_categories_table --create=categories
   php artisan make:migration create_suppliers_table --create=suppliers
   php artisan make:migration create_transactions_table --create=transactions
   php artisan make:migration create_transaction_items_table --create=transaction_items
Contoh migration singkat (create_products_table):
   Schema::create('products', function (Blueprint $table) {
       $table->id();
       $table->string('name');
       $table->bigInteger('price');
       $table->integer('stock')->default(0);
       $table->foreignId('category_id')->nullable()->constrained()->nullOnDelete();
       $table->timestamps();
   });
4) Model & Resource: php artisan make:model Product -m
5) Auth (sanctum): composer require laravel/sanctum
   php artisan vendor:publish --provider="Laravel\Sanctum\SanctumServiceProvider"
   Setup middleware in kernel, lalu use token-based auth for SPA/Mobile.
6) Routes (routes/api.php) contoh:
   Route::post('login', [AuthController::class,'login']);
   Route::middleware('auth:sanctum')->group(function(){
     Route::apiResource('products', ProductController::class);
     Route::apiResource('users', UserController::class);
     Route::post('transactions/checkout', [TransactionController::class,'checkout']);
   });
7) Controller contoh (TransactionController@checkout): Validasi input, kurangi stock, simpan transaksi + item, return JSON.
8) Seeder: tambahkan data awal (users dengan role superadmin/admin/operator/user) menggunakan factories.
9) CORS & Env: pastikan CORS di AllowOrigin untuk frontend.
DEPLOY: gunakan Forge / Vapor / VPS (NGINX + PHP-FPM + MySQL). Jangan simpan .env ke repo.

BACKEND: Node.js (Express) + MySQL — Quick scaffolding & sample
1) Inisialisasi: mkdir mrs-backend-node && npm init -y
2) Install: npm i express mysql2 sequelize cors dotenv jsonwebtoken bcryptjs
3) Struktur: /models /controllers /routes /middlewares /config
4) Contoh model Sequelize (Product):
   const Product = sequelize.define('Product',{ id:{type:DataTypes.INTEGER,primaryKey:true,autoIncrement:true}, name:DataTypes.STRING, price:DataTypes.BIGINT, stock:DataTypes.INTEGER, category:DataTypes.STRING });
5) Auth: bcrypt untuk hash password, jsonwebtoken untuk token.
6) Routes contoh: POST /api/login -> returns JWT; GET /api/products -> list; POST /api/products (admin) -> create; POST /api/transactions/checkout -> create transaction, adjust stock
7) Middleware: auth middleware to verify JWT and role-based access.
SAMPLE Express controller pseudo-code (checkout): verify stock for each item; start transaction (sequelize.transaction); create transaction record and transaction_items; decrement product stock; commit; return JSON success.

FRONTEND & AUTH FLOW (connect to API)
- Frontend (current HTML) bisa dikonversi ke React. Saat login nyata:
  1) POST /api/login {email,password} -> returns token + user
  2) Simpan token di localStorage (key: mrs_token) dan user di mrs_current_user
  3) Sertakan Authorization: Bearer <token> di tiap request
  4) Protected routes: token must be valid and role checked on backend

DATABASE SCHEMA (ringkasan)
- users: id, name, email, password, role, phone, created_at, updated_at
- categories: id, name
- suppliers: id, name, contact
- products: id, name, price, stock, category_id, supplier_id
- transactions: id, user_id, total, method, status, created_at
- transaction_items: id, transaction_id, product_id, price, qty

CI & Deploy notes
- Gunakan migrations + seeders
- Test endpoints dengan Postman / Insomnia
- Setup process manager (pm2) untuk Node, Supervisor/systemd untuk PHP queue
- Backup DB secara regular

NEXT STEPS I CAN DO NOW (pilih, saya akan tambahkan ke canvas):
- Generate full Laravel project skeleton (controllers, models, routes) dan tampilkan file .zip
- Generate full Express project skeleton with Sequelize and sample controllers and output .zip
- Convert frontend to React + Tailwind with API integration (login, protected routes)
- Implement real authentication in the frontend example (login form + token storage)

Saya sudah menambahkan petunjuk backend singkat dan skema ke dokumen. Untuk melanjutkan, beri tahu mana yang mau Anda lihat: "Laravel", "Node", "React", atau "Auth nyata" — atau bilang "semua" dan saya akan generate kode lengkap (file) yang bisa didownload.
-->
</html>
