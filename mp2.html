<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistem Penjualan Offline & Online + Role Management</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <style>
        body { background: #f8f9fa; }
        .role-badge { font-size: 14px; }
    </style>
</head>
<body>

<div class="container mt-4">
    <h2 class="text-center fw-bold">SISTEM PENJUALAN + ROLE (Superadmin, Admin, Operator, Konsumen)</h2>
    <hr>

    <!-- LOGIN ROLE -->
    <div class="card mb-4">
        <div class="card-header fw-bold">Login Pengguna</div>
        <div class="card-body">
            <select id="roleSelect" class="form-select mb-3">
                <option value="superadmin">Superadmin</option>
                <option value="admin">Admin</option>
                <option value="operator">Operator</option>
                <option value="konsumen">Konsumen</option>
            </select>
            <button class="btn btn-primary" onclick="loginRole()">Login Role</button>
            <span class="ms-3 badge bg-success role-badge" id="currentRole">Role: -</span>
        </div>
    </div>

    <!-- PRODUK (Hanya Superadmin, Admin, Operator) -->
    <div id="productManagement" class="card mb-4 d-none">
        <div class="card-header fw-bold">Manajemen Produk</div>
        <div class="card-body">
            <input id="productName" type="text" placeholder="Nama Produk" class="form-control mb-2">
            <input id="productPrice" type="number" placeholder="Harga" class="form-control mb-2">
            <button class="btn btn-success" onclick="addProduct()">Tambah Produk</button>

            <hr>
            <h5>Daftar Produk</h5>
            <ul id="productList" class="list-group"></ul>
        </div>
    </div>

    <!-- KONSUMEN BELI PRODUK -->
    <div id="buySection" class="card mb-4 d-none">
        <div class="card-header fw-bold">Pembelian Produk (Konsumen)</div>
        <div class="card-body">
            <h5>Pilih Produk</h5>
            <select id="buyProduct" class="form-select mb-3"></select>

            <h5>Metode Pembayaran</h5>
            <select id="paymentMethod" class="form-select mb-3" onchange="showPaymentForm()">
                <option value="cash">Cash</option>
                <option value="transfer">Transfer</option>
                <option value="kredit">Kredit</option>
            </select>

            <div id="paymentForm"></div>
        </div>
    </div>

    <!-- TRANSAKSI (Admin & Superadmin) -->
    <div id="transactionSection" class="card mb-4 d-none">
        <div class="card-header fw-bold">Manajemen Transaksi</div>
        <div class="card-body">
            <ul id="transactionList" class="list-group"></ul>
        </div>
    </div>
</div>

<script>
let role = null;
let products = JSON.parse(localStorage.getItem('products') || '[]');
let transactions = JSON.parse(localStorage.getItem('transactions') || '[]');

function save() {
    localStorage.setItem('products', JSON.stringify(products));
    localStorage.setItem('transactions', JSON.stringify(transactions));
}

// LOGIN ROLE
function loginRole() {
    role = document.getElementById('roleSelect').value;
    document.getElementById('currentRole').innerText = 'Role: ' + role.toUpperCase();

    // Tampilkan halaman berdasarkan role
    document.getElementById('productManagement').classList.toggle('d-none', !(role === 'superadmin' || role === 'admin' || role === 'operator'));
    document.getElementById('transactionSection').classList.toggle('d-none', !(role === 'superadmin' || role === 'admin'));
    document.getElementById('buySection').classList.toggle('d-none', role !== 'konsumen');

    loadProducts();
    loadTransactions();
}

// TAMBAH PRODUK (Admin / Superadmin / Operator)
function addProduct() {
    const name = document.getElementById('productName').value;
    const price = Number(document.getElementById('productPrice').value);

    if (!name || !price) return Swal.fire('Error', 'Nama & Harga wajib diisi', 'error');

    products.push({ name, price });
    save();
    loadProducts();

    Swal.fire('Berhasil', 'Produk ditambahkan', 'success');
}

function loadProducts() {
    const list = document.getElementById('productList');
    const selectBuy = document.getElementById('buyProduct');

    list.innerHTML = '';
    selectBuy.innerHTML = '';

    products.forEach((p, i) => {
        if (role !== 'konsumen') {
            list.innerHTML += `<li class='list-group-item d-flex justify-content-between'>
                ${p.name} - Rp ${p.price.toLocaleString()}
                <button class='btn btn-danger btn-sm' onclick='delProduct(${i})'>Hapus</button>
            </li>`;
        }

        selectBuy.innerHTML += `<option value='${i}'>${p.name} - Rp ${p.price.toLocaleString()}</option>`;
    });
}

function delProduct(i) {
    products.splice(i, 1);
    save();
    loadProducts();
}

// PEMBAYARAN KONSUMEN
function showPaymentForm() {
    const method = document.getElementById('paymentMethod').value;
    const form = document.getElementById('paymentForm');

    if (method === 'cash') {
        form.innerHTML = `
            <label class='mt-2'>Jumlah Uang</label>
            <input id='cashPay' class='form-control mb-2' type='number'>
            <button class='btn btn-primary' onclick='payCash()'>Bayar Cash</button>
        `;
    }

    if (method === 'transfer') {
        form.innerHTML = `
            <label>Total Bayar (Sesuai Harga)</label>
            <input id='tfAmount' type='number' class='form-control mb-2'>
            <label>Upload Bukti</label>
            <input id='tfBukti' type='file' class='form-control mb-2'>
            <button class='btn btn-primary' onclick='payTransfer()'>Konfirmasi Transfer</button>
        `;
    }

    if (method === 'kredit') {
        form.innerHTML = `
            <label>Pilih Tenor Kredit</label>
            <select id='tenor' class='form-select mb-2'>
                <option value='1'>1 Bulan</option>
                <option value='3'>3 Bulan</option>
                <option value='6'>6 Bulan</option>
                <option value='9'>9 Bulan</option>
                <option value='12'>12 Bulan</option>
            </select>
            <button class='btn btn-warning' onclick='payKredit()'>Ajukan Kredit</button>
        `;
    }
}

// CASH
function payCash() {
    const p = products[document.getElementById('buyProduct').value];
    const bayar = Number(document.getElementById('cashPay').value);

    if (bayar < p.price) return Swal.fire('Kurang!', 'Uang tidak cukup', 'error');

    transactions.push({ product:p.name, price:p.price, metode:'cash', status:'Lunas' });
    save();
    loadTransactions();

    Swal.fire('Berhasil', 'Pembayaran berhasil, kembalian Rp ' + (bayar - p.price), 'success');
}

// TRANSFER
function payTransfer() {
    const p = products[document.getElementById('buyProduct').value];
    const bayar = Number(document.getElementById('tfAmount').value);
    const file = document.getElementById('tfBukti').files[0];

    if (!file) return Swal.fire('Error', 'Upload bukti transfer!', 'error');

    const reader = new FileReader();
    reader.onload = () => {
        transactions.push({ product:p.name, price:p.price, metode:'transfer', bayar, bukti:reader.result, status: bayar >= p.price ? 'Lunas' : 'Kurang' });
        save();
        loadTransactions();
        Swal.fire('OK', 'Transfer disimpan', 'success');
    };
    reader.readAsDataURL(file);
}

// KREDIT
function payKredit() {
    const p = products[document.getElementById('buyProduct').value];
    const tenor = document.getElementById('tenor').value;

    const cicilan = Math.round(p.price / tenor);

    transactions.push({ product:p.name, price:p.price, metode:'kredit', tenor, cicilan, status:'Belum Lunas' });
    save();
    loadTransactions();

    Swal.fire('Diajukan', `Kredit ${tenor} bulan. Cicilan Rp ${cicilan.toLocaleString()}`, 'success');
}

// LIST TRANSAKSI (Admin & Superadmin)
function loadTransactions() {
    const list = document.getElementById('transactionList');
    if (!list) return;

    list.innerHTML = '';

    transactions.forEach(t => {
        list.innerHTML += `<li class='list-group-item'>
            <b>${t.product}</b><br>
            Metode: ${t.metode} | Status: <span class='badge bg-info'>${t.status}</span><br>
            Total: Rp ${t.price.toLocaleString()}
        </li>`;
    });
}
</script>

</body>
</html>
